-- https://www.linkedin.com/posts/gauravowlcity_sql-meesho-zomato-activity-7149249545267326976-CKWj?utm_source=share&utm_medium=member_ios

drop database if exists challenges ;
create schema challenges ;
use challenges ;

-- Table 1 - Orders table
-- Columns - Order_id, cust_ID, city_id, order_date, order_status(placed, cancelled) ,order_value

-- Question1. Identify the top 3 customers who have the highest average order value?

create table orders (
	order_id int AUTO_INCREMENT,
	cust_id int,
	city_id int,
	order_date date,
	order_status char(10),
	order_value decimal,
	primary key (`order_id`)
) ;

insert into orders (cust_id, city_id, order_date, order_status, order_value) values (63,8,'2023-01-01','placed','1017'), (46,17,'2023-01-02','cancelled','505.8571'), (71,17,'2023-01-03','placed','1377.7143'), (91,16,'2023-01-04','placed','282'), (46,23,'2023-01-05','cancelled','852.1429'), (82,14,'2023-01-06','cancelled','848.7143'), (47,11,'2023-01-07','placed','836.1429'), (7,13,'2023-01-08','cancelled','590.2857'), (88,14,'2023-01-09','placed','1359.4286'), (75,3,'2023-01-10','cancelled','289.5714'), (13,2,'2023-01-11','cancelled','509.1429'), (48,21,'2023-01-12','cancelled','593.1429'), (93,2,'2023-01-13','placed','93'), (16,13,'2023-01-14','cancelled','46.1429'), (28,9,'2023-01-15','placed','1023.8571'), (29,12,'2023-01-16','placed','411.7143'), (45,10,'2023-01-17','placed','1043.5714'), (25,15,'2023-01-18','cancelled','395'), (27,7,'2023-01-19','placed','373.8571'), (40,15,'2023-01-20','cancelled','766.8571'), (74,13,'2023-01-21','placed','825.4286'), (86,4,'2023-01-22','cancelled','929.4286'), (49,4,'2023-01-23','placed','794.4286'), (5,24,'2023-01-24','placed','854.8571'), (25,18,'2023-01-25','cancelled','789.8571'), (3,11,'2023-01-26','placed','1405.8571'), (59,15,'2023-01-27','placed','1277.1429'), (88,14,'2023-01-28','placed','667.2857'), (46,24,'2023-01-29','placed','377.2857'), (50,22,'2023-01-30','cancelled','1209.7143'), (34,11,'2023-01-31','placed','301.8571'), (62,12,'2023-02-01','cancelled','890.7143'), (55,6,'2023-02-02','cancelled','1404'), (9,7,'2023-02-03','placed','396.4286'), (64,15,'2023-02-04','placed','1327.5714'), (68,21,'2023-02-05','placed','1114'), (77,15,'2023-02-06','cancelled','142.1429'), (21,23,'2023-02-07','cancelled','1128.4286'), (58,5,'2023-02-08','cancelled','105.7143'), (82,4,'2023-02-09','placed','196.8571'), (61,3,'2023-02-10','cancelled','835.2857'), (53,6,'2023-02-11','placed','620.7143'), (82,10,'2023-02-12','cancelled','1122'), (87,16,'2023-02-13','placed','1338.5714'), (49,15,'2023-02-14','cancelled','748.2857'), (24,5,'2023-02-15','cancelled','1403.7143'), (1,4,'2023-02-16','cancelled','1200.8571'), (26,3,'2023-02-17','placed','63.4286'), (84,3,'2023-02-18','cancelled','853.4286'), (23,4,'2023-02-19','placed','712.2857'), (91,14,'2023-02-20','cancelled','1228.1429'), (97,6,'2023-02-21','cancelled','748.2857'), (53,25,'2023-02-22','placed','789.4286'), (15,1,'2023-02-23','placed','1107.2857'), (68,6,'2023-02-24','placed','1270.5714'), (26,9,'2023-02-25','placed','654.2857'), (81,8,'2023-02-26','cancelled','47'), (2,15,'2023-02-27','cancelled','620.2857'), (25,3,'2023-02-28','cancelled','956.7143'), (85,24,'2023-03-01','cancelled','350.8571'), (32,16,'2023-03-02','cancelled','956.5714'), (62,13,'2023-03-03','placed','611.1429'), (62,14,'2023-03-04','cancelled','292.5714'), (5,12,'2023-03-05','placed','336.5714'), (87,7,'2023-03-06','placed','367.2857'), (26,7,'2023-03-07','cancelled','683.2857'), (67,8,'2023-03-08','placed','323.5714'), (42,7,'2023-03-09','cancelled','1007.4286'), (47,4,'2023-03-10','cancelled','1327.5714'), (25,17,'2023-03-11','cancelled','323.2857'), (54,25,'2023-03-12','placed','873.7143'), (5,17,'2023-03-13','placed','706.5714'), (11,3,'2023-03-14','cancelled','1184.1429'), (75,17,'2023-03-15','placed','1137.5714'), (4,16,'2023-03-16','placed','484.8571'), (90,22,'2023-03-17','cancelled','391.1429'), (20,18,'2023-03-18','placed','654.5714'), (60,11,'2023-03-19','cancelled','940.8571'), (28,3,'2023-03-20','cancelled','1338.2857'), (16,15,'2023-03-21','placed','194.5714'), (85,16,'2023-03-22','cancelled','1305.2857'), (98,2,'2023-03-23','cancelled','469.5714'), (27,9,'2023-03-24','placed','661.7143'), (64,15,'2023-03-25','placed','519.8571'), (57,20,'2023-03-26','cancelled','474.4286'), (97,21,'2023-03-27','cancelled','1245.7143'), (58,14,'2023-03-28','placed','1136.5714'), (35,17,'2023-03-29','placed','903.7143'), (63,4,'2023-03-30','placed','1126'), (10,20,'2023-03-31','cancelled','1320.5714'), (23,16,'2023-04-01','cancelled','152.2857'), (64,21,'2023-04-02','cancelled','1098.7143'), (70,15,'2023-04-03','placed','1186.2857'), (62,3,'2023-04-04','placed','557'), (98,10,'2023-04-05','cancelled','72.1429'), (1,24,'2023-04-06','cancelled','217.5714'), (39,16,'2023-04-07','cancelled','633.8571'), (15,10,'2023-04-08','cancelled','210'), (52,7,'2023-04-09','cancelled','530'), (3,7,'2023-04-10','cancelled','1251.7143'), (100,1,'2023-04-11','cancelled','870.2857'), (94,19,'2023-04-12','placed','451.4286'), (98,20,'2023-04-13','cancelled','460.1429'), (10,14,'2023-04-14','cancelled','1081.1429'), (63,5,'2023-04-15','cancelled','1131.7143'), (94,5,'2023-04-16','placed','883.1429'), (69,4,'2023-04-17','placed','74.8571'), (30,9,'2023-04-18','placed','77.8571'), (15,24,'2023-04-19','placed','667.7143'), (72,22,'2023-04-20','cancelled','237.4286'), (61,5,'2023-04-21','cancelled','1210.5714'), (84,7,'2023-04-22','cancelled','660.4286'), (26,18,'2023-04-23','cancelled','1265.8571'), (97,25,'2023-04-24','placed','381'), (47,4,'2023-04-25','cancelled','531.2857'), (89,20,'2023-04-26','placed','1042'), (56,1,'2023-04-27','cancelled','224.2857'), (31,14,'2023-04-28','cancelled','1384.1429'), (78,5,'2023-04-29','placed','1257.5714'), (82,5,'2023-04-30','placed','587.2857'), (67,20,'2023-05-01','placed','769.5714'), (14,7,'2023-05-02','placed','1088.5714'), (5,16,'2023-05-03','cancelled','72.4286'), (58,15,'2023-05-04','cancelled','1144.2857'), (52,22,'2023-05-05','cancelled','389.8571'), (19,23,'2023-05-06','placed','149'), (94,8,'2023-05-07','placed','850'), (16,9,'2023-05-08','cancelled','1227.7143'), (96,8,'2023-05-09','placed','653.5714'), (55,9,'2023-05-10','cancelled','468.8571'), (64,23,'2023-05-11','cancelled','801.2857'), (53,21,'2023-05-12','placed','957'), (48,22,'2023-05-13','placed','1056.4286'), (87,25,'2023-05-14','cancelled','888.4286'), (100,23,'2023-05-15','placed','297.7143'), (17,14,'2023-05-16','placed','1265.1429'), (66,9,'2023-05-17','placed','570'), (40,7,'2023-05-18','cancelled','1272.1429'), (79,23,'2023-05-19','cancelled','872.8571'), (79,23,'2023-05-20','placed','771.1429'), (45,25,'2023-05-21','cancelled','1052.8571'), (83,17,'2023-05-22','placed','1027.2857'), (28,11,'2023-05-23','cancelled','432'), (75,3,'2023-05-24','cancelled','829.2857'), (43,2,'2023-05-25','cancelled','264.8571'), (39,17,'2023-05-26','placed','1414.1429'), (13,16,'2023-05-27','placed','926.8571'), (23,5,'2023-05-28','cancelled','133.7143'), (64,18,'2023-05-29','placed','457'), (82,22,'2023-05-30','placed','1232'), (11,18,'2023-05-31','placed','1042.1429'), (21,16,'2023-06-01','cancelled','413.5714'), (77,16,'2023-06-02','cancelled','1392.2857'), (76,24,'2023-06-03','placed','1418.4286'), (38,9,'2023-06-04','placed','484.7143'), (76,14,'2023-06-05','cancelled','477.4286'), (62,18,'2023-06-06','cancelled','1058.4286'), (10,8,'2023-06-07','placed','1419.5714'), (57,6,'2023-06-08','cancelled','447.5714'), (27,6,'2023-06-09','cancelled','226.7143'), (55,23,'2023-06-10','cancelled','999.7143'), (1,21,'2023-06-11','placed','490.1429'), (6,23,'2023-06-12','placed','1403.2857'), (63,23,'2023-06-13','placed','681.7143'), (51,20,'2023-06-14','placed','86.5714'), (35,22,'2023-06-15','cancelled','67.8571'), (67,7,'2023-06-16','cancelled','791.2857'), (55,11,'2023-06-17','cancelled','665.2857'), (50,12,'2023-06-18','cancelled','1030.4286'), (13,21,'2023-06-19','placed','1155.8571'), (48,4,'2023-06-20','placed','1254.2857'), (50,11,'2023-06-21','placed','869.7143'), (35,13,'2023-06-22','cancelled','544.1429'), (2,21,'2023-06-23','cancelled','434.8571'), (69,10,'2023-06-24','placed','1126.4286'), (40,10,'2023-06-25','cancelled','952.8571'), (24,8,'2023-06-26','cancelled','177.5714'), (99,18,'2023-06-27','placed','613.7143'), (93,18,'2023-06-28','placed','1122.1429'), (19,17,'2023-06-29','cancelled','1020.7143'), (67,7,'2023-06-30','cancelled','404.7143'), (100,7,'2023-07-01','placed','123.1429'), (11,19,'2023-07-02','placed','924.5714'), (73,23,'2023-07-03','placed','779.2857'), (77,3,'2023-07-04','cancelled','1008.5714'), (25,3,'2023-07-05','placed','48.1429'), (65,21,'2023-07-06','cancelled','769.1429'), (15,6,'2023-07-07','cancelled','1055.1429'), (78,10,'2023-07-08','cancelled','136.4286'), (94,25,'2023-07-09','placed','1095.8571'), (71,20,'2023-07-10','placed','880.7143'), (23,13,'2023-07-11','cancelled','943.2857'), (77,4,'2023-07-12','placed','85.1429'), (71,9,'2023-07-13','cancelled','605.4286'), (69,2,'2023-07-14','placed','1218.5714'), (40,13,'2023-07-15','placed','570.1429'), (99,23,'2023-07-16','placed','1340.5714'), (57,5,'2023-07-17','placed','776.8571'), (10,14,'2023-07-18','placed','835'), (85,21,'2023-07-19','placed','334.7143'), (80,17,'2023-07-20','cancelled','1212.2857'), (71,16,'2023-07-21','placed','293.7143'), (32,2,'2023-07-22','cancelled','648.8571'), (20,4,'2023-07-23','placed','899.4286'), (14,23,'2023-07-24','placed','549.5714'), (44,8,'2023-07-25','cancelled','559.1429'), (94,9,'2023-07-26','placed','1305.8571'), (35,4,'2023-07-27','placed','280.7143'), (34,24,'2023-07-28','placed','984.8571'), (44,22,'2023-07-29','placed','1038.8571'), (79,11,'2023-07-30','cancelled','1278'), (61,18,'2023-07-31','cancelled','385.5714'), (85,12,'2023-08-01','placed','836.8571'), (14,22,'2023-08-02','cancelled','1242.4286'), (57,20,'2023-08-03','cancelled','1009'), (65,9,'2023-08-04','placed','1310.7143'), (84,20,'2023-08-05','placed','941.7143'), (53,9,'2023-08-06','cancelled','95.1429'), (41,7,'2023-08-07','placed','616'), (100,17,'2023-08-08','cancelled','1382.4286'), (82,9,'2023-08-09','placed','764.7143'), (29,5,'2023-08-10','placed','766.4286'), (14,25,'2023-08-11','placed','1031.4286'), (58,22,'2023-08-12','cancelled','881.5714'), (28,25,'2023-08-13','placed','747'), (73,3,'2023-08-14','cancelled','256.8571'), (54,4,'2023-08-15','placed','797.4286'), (62,11,'2023-08-16','cancelled','1259.8571'), (36,4,'2023-08-17','cancelled','807.5714'), (10,16,'2023-08-18','cancelled','1287.1429'), (50,7,'2023-08-19','cancelled','980'), (78,2,'2023-08-20','cancelled','1124.7143'), (13,3,'2023-08-21','placed','514.5714'), (15,19,'2023-08-22','placed','1297.1429'), (24,24,'2023-08-23','cancelled','493.4286'), (23,9,'2023-08-24','placed','1387.8571'), (26,7,'2023-08-25','placed','824.4286'), (38,2,'2023-08-26','cancelled','1209.1429'), (77,22,'2023-08-27','cancelled','310.1429'), (95,3,'2023-08-28','cancelled','202.2857'), (23,2,'2023-08-29','cancelled','812.8571'), (44,24,'2023-08-30','cancelled','800.1429'), (7,20,'2023-08-31','placed','470.2857'), (69,20,'2023-09-01','placed','487.1429'), (68,17,'2023-09-02','placed','716'), (28,6,'2023-09-03','placed','1047.2857'), (63,7,'2023-09-04','placed','124.2857'), (88,18,'2023-09-05','cancelled','1319.8571'), (13,23,'2023-09-06','placed','1048.1429'), (36,1,'2023-09-07','cancelled','386'), (16,3,'2023-09-08','placed','379.2857'), (93,8,'2023-09-09','placed','1366.4286'), (92,7,'2023-09-10','placed','741.2857'), (15,21,'2023-09-11','cancelled','398.1429'), (72,21,'2023-09-12','cancelled','931.8571'), (6,3,'2023-09-13','cancelled','1372.7143'), (61,17,'2023-09-14','placed','838.4286'), (1,6,'2023-09-15','placed','618'), (55,23,'2023-09-16','placed','952.7143'), (9,18,'2023-09-17','placed','261.2857'), (77,17,'2023-09-18','cancelled','794.4286'), (91,25,'2023-09-19','placed','483.1429'), (99,6,'2023-09-20','cancelled','836.2857'), (72,16,'2023-09-21','placed','1386'), (75,25,'2023-09-22','cancelled','633.2857'), (87,15,'2023-09-23','placed','1410'), (59,11,'2023-09-24','placed','1413.5714'), (91,10,'2023-09-25','placed','1061.8571'), (97,21,'2023-09-26','placed','1191.2857'), (25,4,'2023-09-27','cancelled','320.1429'), (74,1,'2023-09-28','placed','1002.8571'), (12,21,'2023-09-29','placed','1409.7143'), (13,5,'2023-09-30','placed','129'), (13,9,'2023-10-01','cancelled','352.2857'), (66,25,'2023-10-02','placed','1030.8571'), (73,8,'2023-10-03','placed','1325.5714'), (12,5,'2023-10-04','placed','1348.7143'), (1,24,'2023-10-05','placed','397.7143'), (21,15,'2023-10-06','placed','637'), (52,11,'2023-10-07','cancelled','71'), (16,15,'2023-10-08','placed','1412.2857'), (35,23,'2023-10-09','placed','89.8571'), (90,5,'2023-10-10','cancelled','245.1429'), (75,15,'2023-10-11','placed','906.7143'), (26,19,'2023-10-12','placed','250'), (57,12,'2023-10-13','placed','649'), (91,5,'2023-10-14','cancelled','1242.4286'), (27,8,'2023-10-15','placed','1161'), (81,18,'2023-10-16','cancelled','1163.4286'), (5,17,'2023-10-17','cancelled','554.4286'), (44,23,'2023-10-18','cancelled','1071.4286'), (52,20,'2023-10-19','cancelled','1068'), (2,1,'2023-10-20','placed','705.7143'), (50,10,'2023-10-21','placed','914.7143'), (41,11,'2023-10-22','cancelled','542'), (82,4,'2023-10-23','cancelled','467.5714'), (42,1,'2023-10-24','cancelled','804.5714'), (66,23,'2023-10-25','cancelled','590.4286'), (65,12,'2023-10-26','cancelled','767.4286'), (39,6,'2023-10-27','placed','582.4286'), (70,25,'2023-10-28','placed','860.2857'), (5,8,'2023-10-29','cancelled','685.2857'), (61,18,'2023-10-30','cancelled','877.4286'), (23,17,'2023-10-31','cancelled','1319.4286'), (35,14,'2023-11-01','placed','565'), (72,21,'2023-11-02','cancelled','1116.8571'), (19,18,'2023-11-03','placed','586.7143'), (50,4,'2023-11-04','cancelled','57.2857'), (19,14,'2023-11-05','placed','729.4286'), (8,11,'2023-11-06','placed','585.2857'), (59,15,'2023-11-07','cancelled','114.7143'), (100,24,'2023-11-08','cancelled','146'), (85,24,'2023-11-09','cancelled','785.7143'), (81,22,'2023-11-10','placed','227.5714'), (58,13,'2023-11-11','placed','952.1429'), (43,13,'2023-11-12','placed','1125.5714'), (36,15,'2023-11-13','cancelled','548.5714'), (50,3,'2023-11-14','cancelled','1001.1429'), (97,5,'2023-11-15','cancelled','714.5714'), (97,16,'2023-11-16','cancelled','595'), (50,2,'2023-11-17','placed','1275.1429'), (19,25,'2023-11-18','placed','322.2857'), (1,3,'2023-11-19','placed','522'), (46,4,'2023-11-20','placed','1196.8571'), (60,3,'2023-11-21','cancelled','519.8571'), (95,5,'2023-11-22','cancelled','1103.1429'), (22,22,'2023-11-23','cancelled','431.8571'), (56,18,'2023-11-24','cancelled','1190'), (19,2,'2023-11-25','cancelled','127'), (44,17,'2023-11-26','cancelled','281.8571'), (99,15,'2023-11-27','cancelled','298'), (98,17,'2023-11-28','cancelled','864.7143'), (16,24,'2023-11-29','cancelled','195.2857'), (71,8,'2023-11-30','placed','845'), (68,6,'2023-12-01','cancelled','1354.8571'), (34,2,'2023-12-02','placed','446.2857'), (23,13,'2023-12-03','cancelled','143.7143'), (55,19,'2023-12-04','cancelled','1240.1429'), (21,16,'2023-12-05','cancelled','1312.1429'), (49,20,'2023-12-06','cancelled','719.8571'), (29,21,'2023-12-07','cancelled','748.5714'), (31,12,'2023-12-08','placed','150.1429'), (93,15,'2023-12-09','placed','92.2857'), (17,17,'2023-12-10','placed','328.1429'), (35,14,'2023-12-11','placed','1073.8571'), (100,3,'2023-12-12','cancelled','426.1429'), (50,7,'2023-12-13','cancelled','1311.5714'), (22,21,'2023-12-14','placed','748.2857'), (43,21,'2023-12-15','placed','464.7143'), (43,5,'2023-12-16','cancelled','1079.7143'), (12,2,'2023-12-17','placed','161.1429'), (44,3,'2023-12-18','cancelled','1283.7143'), (79,13,'2023-12-19','cancelled','1095.1429'), (30,20,'2023-12-20','cancelled','132.4286'), (35,16,'2023-12-21','placed','43.2857'), (2,5,'2023-12-22','cancelled','901'), (80,21,'2023-12-23','cancelled','1253.2857'), (58,4,'2023-12-24','cancelled','802.8571'), (56,9,'2023-12-25','cancelled','500.5714'), (3,14,'2023-12-26','cancelled','1172.7143'), (17,5,'2023-12-27','placed','239.8571'), (60,12,'2023-12-28','cancelled','1139.8571'), (94,24,'2023-12-29','cancelled','816.1429'), (31,16,'2023-12-30','cancelled','786.1429'), (51,15,'2023-12-31','cancelled','551.8571'), (4,21,'2024-01-01','cancelled','339.8571'), (58,12,'2024-01-02','placed','290.1429'), (40,1,'2024-01-03','placed','1138.5714'), (47,8,'2024-01-04','cancelled','908'), (90,10,'2024-01-05','placed','1377.7143'), (44,13,'2024-01-06','cancelled','756') ;

with tmp as (select cust_id, avg(order_value) `average order value`
from orders
where order_status='placed'
group by cust_id)
select * from (select *, dense_rank() over(order by `average order value` desc) rnk from tmp ) x where rnk <= 3 ;
